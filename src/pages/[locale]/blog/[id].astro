---
import Layout from '../../../layouts/Layout.astro';
import { getCollection, render } from 'astro:content';
import { t, LOCALES, type Locale } from '../../../i18n';

export async function getStaticPaths() {
  const collectionMap: Record<typeof LOCALES[number], 'blogFr' | 'blogEn' | 'blogEs'> = { fr: 'blogFr', en: 'blogEn', es: 'blogEs' };
  const paths: { params: { locale: string; id: string }; props: { post: Awaited<ReturnType<typeof getCollection>>[number] } }[] = [];
  for (const locale of LOCALES) {
    const collectionName = collectionMap[locale];
    const posts = await getCollection(collectionName, ({ data }) => !data.draft);
    for (const post of posts) {
      paths.push({ params: { locale, id: post.id }, props: { post } });
    }
  }
  return paths;
}

const { post } = Astro.props;
const { locale } = Astro.params as { locale: Locale; id: string };
const { Content } = await render(post);
const dateLocale = locale === 'fr' ? 'fr-FR' : locale === 'en' ? 'en-US' : 'es-ES';
---
<Layout title={post.data.title} description={post.data.description} locale={locale}>
  <article class="post">
    <header class="post-header">
      <h1>{post.data.title}</h1>
      <time datetime={post.data.pubDate.toISOString()}>
        {post.data.pubDate.toLocaleDateString(dateLocale, { dateStyle: 'long' })}
      </time>
    </header>
    <div class="post-content">
      <Content />
    </div>
  </article>
</Layout>

<style>
  .post-header {
    margin-bottom: 1.5rem;
  }
  .post-header h1 {
    margin: 0 0 0.5rem;
    font-size: 1.75rem;
  }
  .post-header time {
    font-size: 0.9375rem;
    color: #666;
  }
  .post-content :global(h2) {
    margin-top: 1.5rem;
    font-size: 1.25rem;
  }
  .post-content :global(p) {
    margin: 0 0 1rem;
  }
  .post-content :global(ul) {
    margin: 0 0 1rem;
    padding-left: 1.5rem;
  }
</style>
