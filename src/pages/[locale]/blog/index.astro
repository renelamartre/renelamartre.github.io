---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { t, LOCALES, type Locale } from '../../../i18n';

export async function getStaticPaths() {
  return LOCALES.map((locale) => ({ params: { locale } }));
}

const { locale } = Astro.params as { locale: Locale };
const collectionName = (locale === 'fr' ? 'blogFr' : locale === 'en' ? 'blogEn' : 'blogEs') as 'blogFr' | 'blogEn' | 'blogEs';
const posts = (await getCollection(collectionName, ({ data }) => !data.draft)).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
const dateLocale = locale === 'fr' ? 'fr-FR' : locale === 'en' ? 'en-US' : 'es-ES';
---
<Layout title={t(locale, 'blog.title')} description={t(locale, 'blog.description')} locale={locale}>
  <h1>{t(locale, 'blog.title')}</h1>
  <p class="intro">{t(locale, 'blog.intro')}</p>
  <ul class="post-list">
    {posts.map((post) => (
      <li class="post-item">
        <a href={getRelativeLocaleUrl(locale, `blog/${post.id}`)}>
          <span class="post-title">{post.data.title}</span>
          <time class="post-date" datetime={post.data.pubDate.toISOString()}>
            {post.data.pubDate.toLocaleDateString(dateLocale, { dateStyle: 'long' })}
          </time>
        </a>
        {post.data.description && <p class="post-description">{post.data.description}</p>}
      </li>
    ))}
  </ul>
</Layout>

<style>
  .intro {
    margin-bottom: 1.5rem;
    color: #555;
  }
  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .post-item {
    border-bottom: 1px solid #e5e5e5;
    padding: 1rem 0;
  }
  .post-item:last-child {
    border-bottom: none;
  }
  .post-item a {
    text-decoration: none;
    color: inherit;
  }
  .post-item a:hover .post-title {
    text-decoration: underline;
  }
  .post-title {
    display: block;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }
  .post-date {
    font-size: 0.875rem;
    color: #666;
  }
  .post-description {
    margin: 0.5rem 0 0;
    font-size: 0.9375rem;
    color: #555;
    line-height: 1.5;
  }
</style>
