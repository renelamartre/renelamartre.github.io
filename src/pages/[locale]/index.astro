---
import Layout from '../../layouts/Layout.astro';
import BookCard from '../../components/BookCard.astro';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { getBooks } from '../../data/books';
import { t, LOCALES, type Locale } from '../../i18n';

export async function getStaticPaths() {
  return LOCALES.map((locale) => ({ params: { locale } }));
}

const { locale } = Astro.params as { locale: Locale };
const base = import.meta.env.BASE_URL;
const books = getBooks(locale);
const featuredBook = books[0];
const imageUrl = featuredBook.image.startsWith('/') ? `${base}${featuredBook.image.slice(1)}` : `${base}${featuredBook.image}`;
const logoUrl = `${base}logo.jpg`;
const siteTitle = t(locale, 'home.siteTitle');
const bookUrl = featuredBook ? getRelativeLocaleUrl(locale, `livres/${featuredBook.slug}`) : '';
const booksIndexUrl = getRelativeLocaleUrl(locale, 'livres');
const blogUrl = getRelativeLocaleUrl(locale, 'blog');
---
<Layout title={siteTitle} description={t(locale, 'home.siteDescription')} locale={locale}>
  <section class="hero">
    <h1 class="hero-title">{siteTitle}</h1>
    <img src={logoUrl} alt="Logo" class="hero-logo" width="400" height="400" />
    <p class="hero-tagline">{t(locale, 'home.tagline')}</p>
  </section>
  {featuredBook && (
    <section class="featured">
      <h2>{t(locale, 'home.featured')}</h2>
      <article class="featured-book">
        <a href={bookUrl}>
          <img src={imageUrl} alt={featuredBook.title} width="200" height="300" class="featured-image" />
        </a>
        <div class="featured-body">
          <h3><a href={bookUrl}>{featuredBook.title}</a></h3>
          <p>{featuredBook.shortDescription}</p>
          <a href={bookUrl} class="button">{t(locale, 'home.discoverBook')}</a>
        </div>
      </article>
    </section>
  )}
  <nav class="home-links">
    <a href={booksIndexUrl}>{t(locale, 'home.viewAllBooks')}</a>
    <a href={blogUrl}>{t(locale, 'home.viewBlog')}</a>
  </nav>
</Layout>

<style>
  .hero {
    text-align: center;
    padding: 3rem 1.5rem;
    margin: -2rem -1.5rem 2rem;
  }
  .hero-title {
    margin: 0 0 1rem;
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: 0.02em;
  }
  .hero-logo {
    display: block;
    margin: 0 auto;
    max-width: 320px;
    width: 100%;
    height: auto;
    object-fit: contain;
  }
  .hero-tagline {
    margin: 1rem 0 0;
    font-size: 1.125rem;
    color: var(--color-text-muted);
  }
  .featured {
    margin: 2rem 0;
  }
  .featured h2 {
    font-size: 1.125rem;
    margin-bottom: 1rem;
    color: var(--color-text-muted);
  }
  .featured-book {
    display: flex;
    gap: 1.5rem;
    align-items: flex-start;
    padding: 1.5rem;
    border: 1px solid var(--color-border);
    border-radius: 8px;
    background: var(--color-bg-muted);
  }
  .featured-book a {
    color: inherit;
    text-decoration: none;
  }
  .featured-book a:hover {
    text-decoration: underline;
  }
  .featured-image {
    width: 160px;
    height: auto;
    object-fit: cover;
    border-radius: 4px;
  }
  .featured-body h3 {
    margin: 0 0 0.5rem;
    font-size: 1.25rem;
  }
  .featured-body p {
    margin: 0 0 1rem;
    color: var(--color-text-muted);
    font-size: 0.9375rem;
  }
  .button {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--color-accent);
    color: var(--color-accent-text) !important;
    border-radius: 6px;
    font-weight: 500;
  }
  .button:hover {
    background: var(--color-accent-hover);
    text-decoration: none !important;
  }
  .home-links {
    display: flex;
    gap: 1.5rem;
    margin-top: 2rem;
  }
  .home-links a {
    color: var(--color-text);
    font-weight: 500;
  }
  @media (max-width: 480px) {
    .featured-book {
      flex-direction: column;
    }
    .featured-image {
      width: 100%;
      max-width: 200px;
    }
  }
</style>
